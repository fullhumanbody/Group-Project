<!doctype html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-EN">
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>

    <head>
        <title>Hide 'n Show</title>
        <link rel="stylesheet" href="IntegratedPages.css">
        <link rel="stylesheet" href="https://www.w3schools.com/w3css/5/w3.css">
    </head>

    <body class="spotlight-container page0Body">

        <!-- Persistent pages-completed HUD -->
        <div id="pagesCompletedDisplay">Pages completed: 0</div>

        

        <div class="page0">
            <!-- Page 0 content (Start Screen) -->
            <button onclick="showpage()">Pretend I'm the start button</button>
        </div>

        <!-- Page 1: Bug game -->
        <div class="page1">
            <div id="page1lampWrapper" class="lampWrapper">
                <img id="page1handLamp" src="lamp-temp-glow.png" />
            </div>
            <div class="page1banner"></div>
            <div id="page1counter">Catch some bugs!</div>
        </div>

        <!-- Page 2: Bug game result -->
        <div class="page2">
          <h1 class="page2h1">YOU CAUGHT 30 BUGS!</h1>
          <p class="page2p"> Good stuff! <br> Claim your Trophy and go look for some creatures!</p>

          <br>
          <div class="page2trophy">
          
            <a onclick="showpage()">
              <img class="trophyImage trophy-game1"
                   src="trophy-batteries.png"
                   
                   width="100%" height="100%">
            </a>
          </div>
        </div>

        <!-- Page 3: Bush / creatures game  -->
        <div class="page3">
          
    <div class="page3bushImages">
      <img id="page3bush1" src="bush-manzanitabug.png" onmouseover="playSoundLadybug(),foundBush1()" style="width:250px;height:200px;"/>
      <img id="page3bush2" src="bush-coyotedog.png" onmouseover="playSoundCoyote(),foundBush1()"  style="width:250px;height:200px;"/>
      <img id="page3bush3" src="bush-zorro.png" onmouseover="playSoundBush(),foundBush1()" style="width:250px;height:200px;"/>
    </div>
    <!--Sound's creditted in links(becuz we aren't animals)-->
    <audio id="page3coyoteSound" src="Coyote.mp3"></audio>
    <!-- https://www.youtube.com/shorts/_B6ykKbFl2g --->
    <audio id="page3ladybugSound" src="ladybug.m4a"></audio>
    <!-- https://www.youtube.com/watch?v=_aBGa176U8s -->
     <audio id="page3bushSound" src="bush.mp3"></audio>
    <!-- https://www.youtube.com/watch?v=gla8pkGYObQ -->

          <div id="page3winText"
               style="display:none; flex-direction:column; align-items:center; text-align:center; margin-top:200px; color:white;">
            <h2>Congratulations!</h2>
            <p>You found all the creatures!<br> And rustled through an empty bush?.. <br> You're so funny haha! <br> Click your trophy to head to the next adventure!</p>

            
            <img id="page3Trophy"
                 class="trophyImage trophy-game2"
                 src="trophy-bulb.png"
                
                 onclick="showpage()">
          </div>
        </div>

        <!-- Page 4: Flowers game -->
        <div class="page4">

            <!-- Lamp for page 4 (drag logic shared) -->
            <div id="page4lampWrapper" class="lampWrapper">
                <img id="page4handLamp" src="lamp-temp-glow.png" />
            </div>

            <div class="page4plants">
              <div class="page4plant-pos page4p1">
                  <img id="page4plant1" src="plant1_1.png" alt="Plant">
              </div>
              <div class="page4plant-pos page4p2">
                  <img id="page4plant2" src="plant1_1.png" alt="Plant">
              </div>
              <div class="page4plant-pos page4p3">
                  <img id="page4plant3" src="plant1_1.png" alt="Plant">
              </div>
              <div class="page4plant-pos page4p4">
                  <img id="page4plant4" src="plant1_1.png" alt="Plant">
              </div>
              <div class="page4plant-pos page4p5">
                  <img id="page4plant5" src="plant1_1.png" alt="Plant">
              </div>
            </div>

            <h5> Hover your mouse on the flowers to make them grow! </h5>

            <!-- Button must be pressed before trophy can be gotten -->
            <button id="page4completeButton" onclick="completeFlowersGame()">I'm done growing the flowers</button>

            <!-- Win screen for flowers game (trophy screen) -->
            <div id="page4winScreen" class="page4winScreen" style="display:none;">
                <h2>Beautiful! The flowers have grown.</h2>
                <p>Claim your trophy to head to the next adventure!</p>

                <!-- Game 3 trophy: lamp shade (replace src with your actual file) -->
                <div class="page4trophy">
                  <img class="trophyImage trophy-game3"
                       src="trophy-shade.png"
                       
                       onclick="showpage()">
                </div>
            </div>
        </div>

        <!-- Page 5: Find key under rocks -->
        <div class="page5">
          <h2>Find the Hidden Key to unlock this Door!</h2>
          <div id="page5game">
            <div id="page5rock">
              <img src="rock.png" class="page5rock1">
              <img src="rock.png" class="page5rock2">
              <img src="rock.png" class="page5rock3">
              <img src="rock.png" class="page5rock4">
              <img src="rock.png" class="page5rock5">
              <img src="rock.png" class="page5rock6">
              <img src="rock.png" class="page5rock7">
              <img src="rock.png" class="page5rock8">
            </div>
          </div>

          <img src="door.png" class="page5door-closed"
               style="width:12%;height:40%;">

          <!-- Key that leads to Page 6 -->
          <a onclick="showpage()">
            <img src="key.png"
                 alt="secret-door"
                 style="width:5%;height:5%;position:absolute;top:92%;left:8%;z-index:5;"
                 class="page5hidden-item">
          </a>

          <div id="page5game"></div>
          <p id="message"></p>
        </div>

        <!-- Page 6: Last game end screen -->
        <div class="page6">
          <h1 class="page6h1">Key is found, and Door is unlocked!</h1>
          <p class="page6p">Congrats!
          <br> Claim your Trophy, and Thank you for Playing! </br>
          End of Game.</p>

          <!--End Screen -->
          <button class="page6button" onclick="goToTrophyRoom()">Go to Trophy Room</button>

          <br>

          <div class="page6winCup">
            <!-- Game 4 trophy: key (replace src with your actual file) -->
            <img class="trophyImage trophy-game4"
                 src="trophy-key.png"
                 
                 width="100%" height="100%">
          </div>
        </div>

        <!-- Page 7: Trophy Room / Final End Screen with restart -->
        <div class="page7">
          <div class="trophy-room">
            <h1>You collected all the trophies! You made a lamp!</h1>

            <div class="trophy-room-grid">
              <!-- Re-show all trophies here; same srcs as above so you can swap in one place if you want -->
              <img class="trophyImage trophy-game1"
                   src="trophy-batteries.png"
                   >
              <img class="trophyImage trophy-game2"
                   src="trophy-bulb.png"
                   >
              <img class="trophyImage trophy-game3"
                   src="trophy-shade.png"
                   >
              <img class="trophyImage trophy-game4"
                   src="trophy-key.png"
                   ">
            </div>

            <button class="restartButton" onclick="restartGame()">Play again from the start</button>
          </div>
        </div>

        <!-- Remaining placeholder pages (unchanged / unused for now) -->
        <div class="page8">
            This is page 8 test test
        </div>
        <div class="page9">
            This is page 9 test test
        </div>
        <div class="page10">
            This is page 10 test test
        </div>
        <div class="page11">
            This is page 11 test test
        </div>
        <div class="page12">
            This is page 12 test test
        </div>
        <div class="page13">
            This is page 13 test test
        </div>
        <div class="page14">
            This is page 14 test test
        </div>

        <!------------------------------------------------------------------------------------------------------------------------------------>
    </body>

<script>
// helper to move spotlight
function setSpotlight(x, y) {
    document.documentElement.style.setProperty('--cursorX', x + 'px');
    document.documentElement.style.setProperty('--cursorY', y + 'px');
}

function trappedlol() {
    alert("lol vic didnt finish so you're trapped here moohoohaha. or you can go back a single page and escape.");
}

// Flowers grow code
function livFlowers() {
    var plantImages = [
        "plant1_2.png",
        "plant1_3.png",
        "plant1_4.png",
        "plant1_5.png"
    ];

    plantImages.forEach(src => {
        const img = new Image();
        img.src = src;
    });

    $(".page4plant-pos img").each(function () {

        let hoverInt = null;
        let stopTimer = null;
        let index = 0;

        $(this).hover(
            function () {
                const img = $(this);
                clearInterval(hoverInt);
                clearTimeout(stopTimer);
                index = 0;

                hoverInt = setInterval(() => {
                    index = (index + 1) % plantImages.length;
                    img.attr("src", plantImages[index]);
                }, 2000);

                stopTimer = setTimeout(() => {
                    clearInterval(hoverInt);
                }, 10000);
            },

            function () {
                clearInterval(hoverInt);
                clearTimeout(stopTimer);
            }
        );

    });
};


// Crazy Bug Game Code ###############################################################################################################
let bugsZapped = 0;
let maxZaps = 30;
let spawnInterval;  // store interval so we can stop spawning bugs
let bugEnd = true;

function properEndGame() {
  clearInterval(spawnInterval);
  if (bugEnd === true) {
    alert("Congratulations, you have zapped 30 bugs!");
    showpage();
    bugEnd = false;
  } else {
    bugEnd = false;
  }
}

function createBug() {
    const bug = document.createElement("div");
    bug.className = "page1bug";
    document.body.appendChild(bug);

    const bodyWidth = window.innerWidth;
    const bodyHeight = window.innerHeight;

    let posX = Math.random() * (bodyWidth - 80);
    let posY = Math.random() * (bodyHeight - 80);

    let speed = 4;
    let angle = Math.random() * Math.PI * 2;
    let velX = Math.cos(angle) * speed;
    let velY = Math.sin(angle) * speed;

    function moveBug() {
      posX += velX;
      posY += velY;

      if (posX <= 0 || posX >= bodyWidth - 80) velX *= -1;
      if (posY <= 0 || posY >= bodyHeight - 80) velY *= -1;

      velX += (Math.random() - 0.5) * 0.4;
      velY += (Math.random() - 0.5) * 0.4;
      velX = Math.max(Math.min(velX, 5), -5);
      velY = Math.max(Math.min(velY, 5), -5);

      bug.style.left = posX + "px";
      bug.style.top = posY + "px";

      const lamp = document.getElementById("page1lampWrapper");

      // zap counter
      if (isColliding(bug, lamp)) {
          bug.remove();
          bugsZapped++;
          document.getElementById("page1counter").textContent = "Bugs caught: " + bugsZapped;

          if (bugsZapped >= maxZaps) {
              endGame();
          }
          return;
      }

      requestAnimationFrame(moveBug);
    }

    moveBug();
}

function isColliding(a, b) {
    const r1 = a.getBoundingClientRect();
    const r2 = b.getBoundingClientRect();

    return !(r1.right < r2.left ||
             r1.left > r2.right ||
             r1.bottom < r2.top ||
             r1.top > r2.bottom);
}

function endGame() {
  clearInterval(spawnInterval);
  properEndGame();
  bugEnd = false;
}

window.onload = function () {
  // spawn 1 bug at the start
  for (let i = 0; i < 1; i++) {
    createBug();
  }
  // we start continuous spawning when Page 1 shows
};


// Shared lamp drag code for any .lampWrapper (page1, page3, page4, ...)
$(function () {
  let isDragging = false;
  let offsetX, offsetY;
  let $currentLamp = null;

  $(document).on("mousedown", ".lampWrapper", function (e) {
    isDragging = true;
    $currentLamp = $(this);
    offsetX = e.clientX - $currentLamp.position().left;
    offsetY = e.clientY - $currentLamp.position().top;
    $currentLamp.css("cursor", "grabbing");
  });

  $(document).on("mousemove", function (e) {
    if (isDragging && $currentLamp) {
      const left = e.clientX - offsetX;
      const top  = e.clientY - offsetY;

      $currentLamp.css({ left, top });

      // If spotlight is active, center the light on the lamp instead of the mouse
      if (document.body.classList.contains('spotlight-container')) {
        const rect = $currentLamp[0].getBoundingClientRect();
        setSpotlight(
          rect.left + rect.width / 2,
          rect.top  + rect.height / 2
        );
      }
    }
  });

  $(document).on("mouseup", function () {
    if ($currentLamp) {
      $currentLamp.css("cursor", "grab");
    }
    isDragging = false;
    $currentLamp = null;
  });
});

function removeDivsByClass(className) {
    const elementsToRemove = document.querySelectorAll(`div.${className}`);
    elementsToRemove.forEach(element => {
        if (element.parentNode) {
            element.parentNode.removeChild(element);
        }
    });
}

// Bush game state
var bush1Found = false;
var bush2Found = false;
var bush3Found = false;

function foundBush1() {
    if (bush1Found === true) {
        console.log("Bush 1 is found");
    }
    if (bush2Found === true) {
        console.log("Bush 2 is found");
    }
    if (bush3Found === true) {
        console.log("Bush 3 is found");
    }

    if (bush1Found === true && bush2Found === true && bush3Found === true) {
        console.log("You found all the animals!");
        checkWinCondition();
    }
}

var sound = document.getElementById('page3coyoteSound');
var coyoteBush = document.getElementById("page3bush2");
function playSoundCoyote() {

  if (bush2Found === false) {
    bush2Found = true;
    if (sound.paused) {
        sound.currentTime = 0;
        sound.play();
        coyoteBush.classList.add("w3-animate-fadingAway");
        setTimeout(() => {
          coyoteBush.style.visibility = "hidden";
          coyoteBush.classList.remove("w3-animate-fadingAway");
        }, 4800);
    }
  }
}

var bugsound = document.getElementById('page3ladybugSound');
var ladybugBush = document.getElementById("page3bush1");
function playSoundLadybug() {

  if (bush1Found === false) {
    bush1Found = true;
    if (bugsound.paused) {
        bugsound.currentTime = 0;
        bugsound.play();
        ladybugBush.classList.add("w3-animate-fadingAway");
        setTimeout(() => {
          ladybugBush.style.visibility = "hidden";
          ladybugBush.classList.remove("w3-animate-fadingAway");
        }, 4800);
    }
  }
}

var Bushsound = document.getElementById('page3bushSound');
var bushBush = document.getElementById("page3bush3");
function playSoundBush() {

  if (bush3Found === false) {
    bush3Found = true;
    if (Bushsound.paused) {
        Bushsound.currentTime = 0;
        Bushsound.play();
        bushBush.classList.add("w3-animate-fadingAway");
        setTimeout(() => {
          bushBush.style.visibility = "hidden";
          bushBush.classList.remove("w3-animate-fadingAway");
        }, 4800);
    }
  }
}

var winText = document.getElementById('page3winText');
var dingdong = false;
function checkWinCondition() {
  if (bush1Found === true && bush2Found === true && bush3Found === true) {
    if (dingdong === false) {
      dingdong = true;
      console.log("You found all the animals HURAYYY!!!!");

      // Show win text + trophy
      winText.style.display = "flex";
      console.log("Bush game complete – waiting for trophy click.");

      // Count this as completed so next showpage() goes to flowers page
      playerReward = 3;
      updatePagesCompletedDisplay();

      // Turn off spotlight and show cursor so trophy is easy to click
      document.body.classList.remove('spotlight-container');
      document.body.style.cursor = 'default';
    }
  }
}

// Spotlight logic (start page has it disabled via CSS override)
function update(e){
    // If spotlight-container is removed (e.g. page0 or after bush win), do nothing
    if (!document.body.classList.contains('spotlight-container')) return;

    // On hidden-animal page, the lamp controls spotlight (via drag), so ignore mouse
    if (document.body.classList.contains('page3body')) {
        return;
    }

    var x = e.clientX || (e.touches && e.touches[0].clientX) || 0;
    var y = e.clientY || (e.touches && e.touches[0].clientY) || 0;
    setSpotlight(x, y);
}

document.addEventListener('mousemove',update)
document.addEventListener('touchmove',update)

const rocks = document.getElementById('page5rock').children;

for (let i = 0; i < rocks.length; i++) {
    const rock = rocks[i]
    rock.addEventListener("click", () => {
        rock.style.opacity = "0";
        rock.style.pointerEvents = "none";
    });

    rock.addEventListener("transitionend", () => {
        const style = getComputedStyle(rock);
        if (style.zIndex > 0) {
            message.textContent ="YOU WIN! The door is Unlocked!";
            message.style.color = "gold";
            enableKeyDragging();
        }
    });
}

// ---------------
// Page element refs
// ---------------
var page0 = document.getElementsByClassName("page0")[0];
var page1 = document.getElementsByClassName("page1")[0];
var page2 = document.getElementsByClassName("page2")[0];
var page3 = document.getElementsByClassName("page3")[0];
var page4 = document.getElementsByClassName("page4")[0];
var page5 = document.getElementsByClassName("page5")[0];
var page6 = document.getElementsByClassName("page6")[0];
var page7 = document.getElementsByClassName("page7")[0];
var page8 = document.getElementsByClassName("page8")[0];
var page9 = document.getElementsByClassName("page9")[0];
var page10 = document.getElementsByClassName("page10")[0];
var page11 = document.getElementsByClassName("page11")[0];
var page12 = document.getElementsByClassName("page12")[0];
var page13 = document.getElementsByClassName("page13")[0];
var page14 = document.getElementsByClassName("page14")[0];

console.log("The page works");

// ----------------------
// Player reward / pages-completed HUD
// ----------------------
let playerReward = 0;

function updatePagesCompletedDisplay() {
    const el = document.getElementById("pagesCompletedDisplay");
    if (el) {
        el.textContent = "Pages completed: " + playerReward;
    }
}
updatePagesCompletedDisplay();

// Hide all non-start pages at load
page1.style.display = "none";
page2.style.display = "none";
page3.style.display = "none";
page4.style.display = "none";
page5.style.display = "none";
page6.style.display = "none";
page7.style.display = "none";
page8.style.display = "none";
page9.style.display = "none";
page10.style.display = "none";
page11.style.display = "none";
page12.style.display = "none";
page13.style.display = "none";
page14.style.display = "none";

// ----------------------
// Main page progression
// ----------------------
function showpage() {
    console.log("showpageTest function called");

    playerReward = playerReward + 1;
    updatePagesCompletedDisplay();
    console.log("playerReward is now: " + playerReward);

    if (playerReward === 1) {
        page1.style.display = "block";
        page0.style.display = "none";
        document.body.classList.remove("spotlight-container","page0Body");
        document.body.classList.add("page1body");

        // start bug spawning here
        spawnInterval = setInterval(createBug, 500);

    } else if (playerReward === 2 && bugsZapped >= maxZaps) {
        console.log("Switching to page 2");
        page2.style.display = "block";
        page1.style.display = "none";
        document.body.classList.remove("page1body");
        document.body.classList.add("page2body");
        removeDivsByClass('page1bug');

    } else if (playerReward === 3) {
        page3.style.display = "block";
        page2.style.display = "none";
        document.body.classList.remove("page2body");
        document.body.classList.add("spotlight-container","page3body");
        document.body.style.cursor = "none";

        // Center spotlight on the page3 lamp when the page first loads
        const lamp3 = document.getElementById("page3lampWrapper");
        if (lamp3) {
            const r = lamp3.getBoundingClientRect();
            setSpotlight(r.left + r.width / 2, r.top + r.height / 2);
        }

    } else if (playerReward === 4) {
        alert("Wow you really found those animals! And the one bush! George Bush?");
        page4.style.display = "block";
        page3.style.display = "none";
        document.body.classList.remove("spotlight-container","page3body");
        document.body.classList.add("page4body");
        document.body.style.cursor = "default";
        livFlowers();

    } else if (playerReward === 5) {
        page4.style.display = "none";
        page5.style.display = "block";
        document.body.classList.remove("page4body");
        document.body.classList.add("page5body");

    } else if (playerReward === 6) {
        page5.style.display = "none";
        page6.style.display = "block";
        document.body.classList.remove("page5body");
        document.body.classList.add("page6body");

    } else if (playerReward === 7) {
        // Trophy Room
        goToTrophyRoom();

    } else if (playerReward === 8) {
        page7.style.display = "none";
        page8.style.display = "block";
    } else if (playerReward === 9) {
        page8.style.display = "none";
        page9.style.display = "block";
    } else if (playerReward === 10) {
        page9.style.display = "none";
        page10.style.display = "block";
    } else if (playerReward === 11) {
        page10.style.display = "none";
        page11.style.display = "block";
    } else if (playerReward === 12) {
        page11.style.display = "none";
        page12.style.display = "block";
    } else if (playerReward === 13) {
        page12.style.display = "none";
        page13.style.display = "block";
    } else if (playerReward === 14) {
        page13.style.display = "none";
        page14.style.display = "block";
    } else {
        console.log("No valid reward");
    }
}

// -------- Flowers game completion -> trophy screen --------
function completeFlowersGame() {
    // Hide plants, lamp and button
    const plants = document.querySelector('.page4plants');
    if (plants) plants.style.display = "none";

    const lamp4 = document.getElementById("page4lampWrapper");
    if (lamp4) lamp4.style.display = "none";

    const btn = document.getElementById("page4completeButton");
    if (btn) btn.style.display = "none";

    // Show win/trophy screen
    const winScreen = document.getElementById("page4winScreen");
    if (winScreen) winScreen.style.display = "block";
}

// ----------------------
// Trophy Room and Restart Logic
// ----------------------

// Go from Page 6 → Trophy Room (Page 7)
function goToTrophyRoom() {
    page6.style.display = "none";
    page7.style.display = "block";

    document.body.classList.remove("page6body");
    document.body.classList.add("trophyRoomBody");

    // count Trophy Room as completed page if you want
    playerReward = 7;
    updatePagesCompletedDisplay();
}

// Full reset: returns everything to Page 0 fresh
function restartGame() {
    // Clear timers / intervals
    clearInterval(spawnInterval);

    // Reset bug game
    bugsZapped = 0;
    bugEnd = true;
    document.getElementById("page1counter").textContent = "Catch some bugs!";
    removeDivsByClass('page1bug');

    // Reset bush game
    bush1Found = false;
    bush2Found = false;
    bush3Found = false;
    dingdong = false;
    ladybugBush.style.visibility = "visible";
    coyoteBush.style.visibility = "visible";
    bushBush.style.visibility = "visible";
    winText.style.display = "none";
    const bushes = document.querySelector('.page3bushImages');
    if (bushes) bushes.style.display = "flex";
    const lamp3 = document.getElementById("page3lampWrapper");
    if (lamp3) lamp3.style.display = "block";

    // Reset flower game
    const plants = document.querySelector('.page4plants');
    if (plants) plants.style.display = "block";

    document.querySelectorAll('.page4plant-pos img').forEach(function(img){
        img.src = "plant1_1.png";
    });

    const lamp4 = document.getElementById("page4lampWrapper");
    if (lamp4) lamp4.style.display = "block";

    const btn4 = document.getElementById("page4completeButton");
    if (btn4) btn4.style.display = "inline-block";

    const winScreen4 = document.getElementById("page4winScreen");
    if (winScreen4) winScreen4.style.display = "none";

    // Reset rocks / message
    for (let i = 0; i < rocks.length; i++) {
        rocks[i].style.opacity = "1";
        rocks[i].style.pointerEvents = "auto";
    }
    const messageEl = document.getElementById("message");
    if (messageEl) {
        messageEl.textContent = "";
        messageEl.style.color = "";
    }

    // Hide all pages except Page 0
    page1.style.display = "none";
    page2.style.display = "none";
    page3.style.display = "none";
    page4.style.display = "none";
    page5.style.display = "none";
    page6.style.display = "none";
    page7.style.display = "none";
    page8.style.display = "none";
    page9.style.display = "none";
    page10.style.display = "none";
    page11.style.display = "none";
    page12.style.display = "none";
    page13.style.display = "none";
    page14.style.display = "none";
    page0.style.display = "block";

    // Reset body classes to starting state
    document.body.className = "spotlight-container page0Body";
    document.body.style.cursor = "";

    // Reset playerReward & HUD
    playerReward = 0;
    updatePagesCompletedDisplay();

    console.log("Game fully reset to Page 0.");
}

</script>

</html>
